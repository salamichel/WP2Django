{% extends "base.html" %}

{% block title %}{{ post.seo_title|default:post.title }} - {{ site_name }}{% endblock %}
{% block meta_description %}{{ post.seo_description|default:post.excerpt|truncatewords:25 }}{% endblock %}

{% block content %}
<article class="post-single">
    <header class="post-header">
        <div class="post-meta">
            <time datetime="{{ post.published_at|date:'Y-m-d' }}">{{ post.published_at|date:"d F Y" }}</time>
            {% if post.author %}
            <span class="post-author">par {{ post.author.get_full_name|default:post.author.username }}</span>
            {% endif %}
        </div>
        <h1>{{ post.title }}</h1>
        <div class="post-categories">
            {% for cat in post.categories.all %}
                <a href="{{ cat.get_absolute_url }}" class="tag">{{ cat.name }}</a>
            {% endfor %}
        </div>
    </header>

    {% if post.featured_image and post.featured_image.file %}
    <figure class="post-featured-image">
        <img src="{{ post.featured_image.file.url }}" alt="{{ post.featured_image.alt_text|default:post.title }}">
    </figure>
    {% endif %}

    <div class="post-content">
        {{ post.content|safe }}
    </div>

    <footer class="post-footer">
        {% if post.tags.exists %}
        <div class="post-tags">
            <strong>Tags :</strong>
            {% for tag in post.tags.all %}
                <a href="{{ tag.get_absolute_url }}" class="tag">{{ tag.name }}</a>
            {% endfor %}
        </div>
        {% endif %}
    </footer>
</article>

{% if comments %}
<section class="comments-section">
    <h2>Commentaires ({{ comments|length }})</h2>
    {% for comment in comments %}
    <div class="comment" id="comment-{{ comment.pk }}">
        <div class="comment-meta">
            <strong>{{ comment.author_name }}</strong>
            <time datetime="{{ comment.created_at|date:'Y-m-d' }}">{{ comment.created_at|date:"d F Y H:i" }}</time>
        </div>
        <div class="comment-body">{{ comment.content|linebreaks }}</div>

        {% if comment.replies.exists %}
        <div class="comment-replies">
            {% for reply in comment.replies.all %}
            <div class="comment reply" id="comment-{{ reply.pk }}">
                <div class="comment-meta">
                    <strong>{{ reply.author_name }}</strong>
                    <time datetime="{{ reply.created_at|date:'Y-m-d' }}">{{ reply.created_at|date:"d F Y H:i" }}</time>
                </div>
                <div class="comment-body">{{ reply.content|linebreaks }}</div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
</section>
{% endif %}
{% endblock %}
